<!DOCTYPE html>
<html lang="en" x-data="customerController()" x-init="loadCustomers()">
<head>
    <!-- Same head as dashboard.html -->
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Customer Management</h1>
        
        <div class="mb-6">
            <button @click="openModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded">
                + Add Customer
            </button>
        </div>

        <div class="bg-gray-800 rounded-lg overflow-x-auto">
            <table class="min-w-full">
                <thead class="bg-gray-700">
                    <tr>
                        <th class="py-3 px-4 text-left">Name</th>
                        <th class="py-3 px-4 text-left">Email</th>
                        <th class="py-3 px-4 text-left">Phone</th>
                        <th class="py-3 px-4 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="customer in customers" :key="customer.id">
                        <tr class="border-b border-gray-700 hover:bg-gray-750">
                            <td class="py-3 px-4" x-text="customer.name"></td>
                            <td class="py-3 px-4" x-text="customer.email"></td>
                            <td class="py-3 px-4" x-text="customer.phone"></td>
                            <td class="py-3 px-4">
                                <button @click="editCustomer(customer)" class="text-blue-400 mr-2">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteCustomer(customer.id)" class="text-red-500">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Customer Modal -->
    <div x-show="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-md p-6">
            <h2 class="text-2xl font-bold mb-4" x-text="isEditing ? 'Edit Customer' : 'Add Customer'"></h2>
            
            <form @submit.prevent="saveCustomer">
                <div class="mb-4">
                    <label class="block mb-2">Full Name</label>
                    <input type="text" x-model="formData.name" class="w-full bg-gray-700 rounded p-2" required>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-2">Email</label>
                    <input type="email" x-model="formData.email" class="w-full bg-gray-700 rounded p-2">
                </div>
                
                <div class="mb-4">
                    <label class="block mb-2">Phone</label>
                    <input type="tel" x-model="formData.phone" class="w-full bg-gray-700 rounded p-2" required>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-2">Address</label>
                    <textarea x-model="formData.address" class="w-full bg-gray-700 rounded p-2"></textarea>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" @click="isModalOpen = false" class="bg-gray-600 px-4 py-2 rounded">
                        Cancel
                    </button>
                    <button type="submit" class="bg-indigo-600 px-4 py-2 rounded">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function customerController() {
            return {
                customers: [],
                isModalOpen: false,
                isEditing: false,
                formData: {
                    id: '',
                    name: '',
                    email: '',
                    phone: '',
                    address: ''
                },
                
                async loadCustomers() {
                    try {
                        const response = await fetch('/api/customers');
                        this.customers = await response.json();
                    } catch (error) {
                        console.error('Error loading customers:', error);
                    }
                },
                
                openModal() {
                    this.isEditing = false;
                    this.formData = { id: '', name: '', email: '', phone: '', address: '' };
                    this.isModalOpen = true;
                },
                
                editCustomer(customer) {
                    this.isEditing = true;
                    this.formData = { ...customer };
                    this.isModalOpen = true;
                },
                
                async saveCustomer() {
                    const url = this.isEditing 
                        ? `/api/customers/${this.formData.id}` 
                        : '/api/customers';
                        
                    const method = this.isEditing ? 'PUT' : 'POST';
                    
                    try {
                        const response = await fetch(url, {
                            method,
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.formData)
                        });
                        
                        if (response.ok) {
                            this.isModalOpen = false;
                            this.loadCustomers();
                        }
                    } catch (error) {
                        console.error('Error saving customer:', error);
                    }
                },
                
                async deleteCustomer(id) {
                    if (!confirm('Are you sure you want to delete this customer?')) return;
                    
                    try {
                        await fetch(`/api/customers/${id}`, { method: 'DELETE' });
                        this.loadCustomers();
                    } catch (error) {
                        console.error('Error deleting customer:', error);
                    }
                }
            };
        }
    </script>
</body>
</html>